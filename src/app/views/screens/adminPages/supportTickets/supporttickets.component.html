<div class="container">
    <h2>Destek Talepleri</h2>

    <!-- Filtreleme Butonları -->
    <div class="filters mb-3">
        <button class="btn btn-success me-2" (click)="filterTickets('Created')">Yeni Açılanlar</button>
        <button class="btn btn-warning me-2" (click)="filterTickets('Customer Answered')">Müşteri Yanıtladı</button>
        <button class="btn btn-primary me-2" (click)="filterTickets('Answered')">Yanıtlananlar</button>
        <button class="btn btn-dark" (click)="filterTickets('Closed')">Kapatılanlar</button>
    </div>

    <!-- Destek Talepleri Tablosu -->
    <table class="table table-hover">
        <thead>
        <tr>
            <th>Başlık</th>
            <th>Konu</th>
            <th>Durum</th>
            <th>Oluşturulma Tarihi</th>
            <th>Mesaj</th>
            <th>İşlemler</th>
        </tr>
        </thead>
        <tbody>
        <tr *ngFor="let ticket of filteredTickets">
            <td>{{ ticket.title }}</td>
            <td>{{ ticket.subject }}</td>
            <td [ngClass]="getStatusClass(ticket.ticketStatus)">
                {{ getTranslatedStatus(ticket.ticketStatus) }}
            </td>
            <td>{{ ticket.createdDate | date:'short' }}</td>
            <td>{{ getLatestComment(ticket.responses) }}</td>
            <td>
                <button class="btn btn-info btn-sm me-2" (click)="openChat(chatModalTemplate, ticket)">Yanıtla</button>
                <button class="btn btn-danger btn-sm" (click)="closeTicket(ticket.id)">Kapat</button>
            </td>
        </tr>
        </tbody>
    </table>

    <!-- Yükleniyor Göstergesi -->
    <div *ngIf="loading" class="text-center mt-4">
        <i class="spinner-border text-primary"></i>
        <span class="ms-2">Yükleniyor...</span>
    </div>

    <!-- Sohbet Modalı -->
    <ng-template #chatModalTemplate>
        <div class="modal-header">
            <h5 class="modal-title">Sohbet</h5>
            <button type="button" class="btn-close" (click)="closeModal()" aria-label="Close"></button>
        </div>
        <div class="modal-body">
            <div class="chat-window">
                <div
                        class="message"
                        *ngFor="let message of chatMessages"
                        [ngClass]="{
        'message-right': !isOwnerMessage(message),
        'message-left': isOwnerMessage(message)
      }"
                >
                    <strong>{{ message.userName }}:</strong> {{ message.comment }}
                </div>
            </div>
            <div class="mt-3">
                <textarea [(ngModel)]="newMessage" class="form-control" rows="3" placeholder="Mesajınızı yazın..."></textarea>
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" (click)="closeModal()">Kapat</button>
            <button type="button" class="btn btn-primary" (click)="sendMessage()">Gönder</button>
        </div>
    </ng-template>
</div>